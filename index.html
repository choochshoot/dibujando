<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programa de Dibujo Yunchen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --morado-oscuro: #4a1e8c;
            --morado-medio: #7b3fe4;
            --morado-claro: #9d6df7;
            --rosa: #ff5c8d;
            --amarillo: #ffd166;
            --blanco: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', cursive, Arial, sans-serif;
            image-rendering: pixelated;
        }

        body {
            background: linear-gradient(135deg, var(--morado-oscuro), var(--morado-medio));
            color: var(--blanco);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            font-size: 16px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
        }

        /* Header Styles */
        header {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 3px solid var(--rosa);
            position: relative;
        }

        .artist-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .avatar-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--amarillo);
            margin-right: 15px;
            background-color: var(--morado-claro);
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .artist-details {
            flex: 1;
        }

        .artist-name {
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--amarillo);
        }

        .coins-container {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 10px 15px;
            border: 2px solid var(--amarillo);
        }

        .coin-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            border-radius: 50%;
            overflow: hidden;
        }

        .coin-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .coins-text {
            font-size: 14px;
            color: var(--amarillo);
        }

        /* Bot√≥n de acceso profesor */
        .admin-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--rosa);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            transition: background 0.3s;
        }

        .admin-btn:hover {
            background: var(--morado-claro);
        }

        /* Modal de contrase√±a */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--morado-oscuro);
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            border: 3px solid var(--rosa);
            text-align: center;
        }

        .modal-title {
            color: var(--amarillo);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .password-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 2px solid var(--morado-claro);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
        }

        .modal-btn {
            background: var(--rosa);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
            flex: 1;
            margin: 0 5px;
        }

        .modal-btn:hover {
            background: var(--morado-claro);
        }

        .modal-btn.cancel {
            background: var(--morado-medio);
        }

        /* Secci√≥n de actualizaci√≥n (oculta inicialmente) */
        .update-controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 3px solid var(--amarillo);
            display: none;
        }

        .control-group {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .control-label {
            display: block;
            margin-bottom: 5px;
            color: var(--amarillo);
            font-size: 14px;
        }

        .url-input, .number-input, .file-input {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 2px solid var(--morado-claro);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .file-input {
            background: rgba(255, 255, 255, 0.15);
        }

        .update-btn {
            background: var(--rosa);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
            width: 100%;
        }

        .update-btn:hover {
            background: var(--morado-claro);
        }

        /* Secci√≥n Logros */
        .section-title {
            font-size: 18px;
            text-align: center;
            margin: 25px 0 15px;
            color: var(--rosa);
            text-shadow: 2px 2px 0 #000;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid var(--morado-claro);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .achievement-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 10px;
            border-radius: 10px;
            overflow: hidden;
            background-color: var(--morado-medio);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .achievement-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .achievement-date {
            font-size: 12px;
            color: var(--amarillo);
        }

        .view-more-container {
            text-align: center;
            margin-bottom: 25px;
        }

        .view-more-btn {
            background: var(--rosa);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .view-more-btn:hover {
            background: var(--morado-claro);
        }

        /* Secci√≥n Programa */
        .program-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 3px solid var(--morado-claro);
        }

        .program-title {
            font-size: 18px;
            color: var(--rosa);
            margin-bottom: 10px;
            text-align: center;
        }

        .program-details {
            font-size: 12px;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.8;
        }

        .topics-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .topic {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--rosa);
        }

        .topic-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .topic-number {
            background: var(--rosa);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .topic-title {
            font-size: 14px;
            color: var(--amarillo);
        }

        .topic-content {
            font-size: 12px;
            margin-left: 40px;
        }

        .topic-section {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .coins-info {
            color: var(--amarillo);
        }

        .reward-info {
            color: var(--rosa);
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--rosa);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--morado-claro);
        }

        /* Efectos pixel art */
        .pixel-border {
            border-style: solid;
            border-width: 4px;
            border-color: var(--blanco) var(--morado-claro) var(--morado-claro) var(--blanco);
        }

        .pixel-text {
            font-family: 'Press Start 2P', cursive;
            letter-spacing: 0.5px;
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }
            
            .artist-name {
                font-size: 14px;
            }
            
            .coins-text {
                font-size: 12px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .achievement-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            .admin-btn {
                position: static;
                margin-top: 10px;
                width: 100%;
                font-size: 12px;
            }
            
            .topic-title {
                font-size: 12px;
            }
            
            .topic-content {
                font-size: 10px;
                margin-left: 0;
            }
            
            .topic-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .topic-number {
                margin-bottom: 5px;
            }
        }

        @media (min-width: 768px) {
            .achievements-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="artist-info">
                <div class="avatar-container" id="avatar-container">
                    <!-- Avatar de Yunchen se cargar√° din√°micamente -->
                </div>
                <div class="artist-details">
                    <div class="artist-name pixel-text">Artista: Yunchen</div>
                    <div class="coins-container">
                        <div class="coin-icon" id="coin-icon">
                            <!-- Icono de coin se cargar√° din√°micamente -->
                        </div>
                        <div class="coins-text pixel-text">Coins Logradas: <span id="coins-count">60</span></div>
                    </div>
                </div>
            </div>
            <button class="admin-btn pixel-text" id="admin-btn">
                <i class="fas fa-user-shield"></i> Acceso Profesor
            </button>
        </header>

        <!-- Panel de actualizaci√≥n (oculto inicialmente) -->
        <div class="update-controls" id="update-controls">
            <h2 class="section-title pixel-text">PANEL DE PROFESOR - ACTUALIZAR CONTENIDO</h2>
            
            <div class="control-group">
                <label class="control-label pixel-text">Actualizar Coins Logradas:</label>
                <input type="number" id="coins-input" class="number-input" placeholder="Nuevo valor de coins" min="0">
                <button class="update-btn pixel-text" onclick="actualizarCoinsDesdeInput()">Actualizar Coins</button>
            </div>
            
            <div class="control-group">
                <label class="control-label pixel-text">Subir Avatar Yunchen:</label>
                <input type="file" id="avatar-file" class="file-input" accept="image/*">
                <button class="update-btn pixel-text" onclick="subirYActualizarAvatar()">Subir y Actualizar Avatar</button>
            </div>
            
            <div class="control-group">
                <label class="control-label pixel-text">Subir Icono Coin:</label>
                <input type="file" id="coin-file" class="file-input" accept="image/*">
                <button class="update-btn pixel-text" onclick="subirYActualizarCoin()">Subir y Actualizar Coin</button>
            </div>
            
            <div class="control-group">
                <label class="control-label pixel-text">Subir Logro Espec√≠fico:</label>
                <input type="number" id="achievement-index" class="number-input" placeholder="√çndice (0-35)" min="0" max="35">
                <input type="file" id="achievement-file" class="file-input" accept="image/*">
                <button class="update-btn pixel-text" onclick="subirYActualizarLogro()">Subir y Actualizar Logro</button>
            </div>
            
            <div class="control-group">
                <label class="control-label pixel-text">Subir Imagen para Todos los Logros:</label>
                <input type="file" id="all-achievements-file" class="file-input" accept="image/*">
                <button class="update-btn pixel-text" onclick="subirYActualizarTodosLogros()">Subir y Actualizar Todos</button>
            </div>
            
            <div class="control-group">
                <button class="update-btn pixel-text" onclick="cerrarPanelProfesor()">
                    <i class="fas fa-times"></i> Cerrar Panel de Profesor
                </button>
            </div>
        </div>

        <!-- Modal de contrase√±a -->
        <div class="modal" id="password-modal">
            <div class="modal-content">
                <h2 class="modal-title pixel-text">ACCESO DE PROFESOR</h2>
                <p style="margin-bottom: 15px; font-size: 12px;" class="pixel-text">Ingresa la contrase√±a para acceder al panel de profesor:</p>
                <input type="password" id="password-input" class="password-input" placeholder="Contrase√±a">
                <div class="modal-buttons">
                    <button class="modal-btn cancel pixel-text" onclick="cerrarModal()">Cancelar</button>
                    <button class="modal-btn pixel-text" onclick="verificarPassword()">Acceder</button>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Logros -->
        <h2 class="section-title pixel-text">LOGROS</h2>
        <div class="achievements-grid" id="achievements-container">
            <!-- Los primeros 4 logros se cargar√°n din√°micamente con JavaScript -->
        </div>
        
        <div class="view-more-container">
            <button class="view-more-btn pixel-text" id="view-more-btn">Ver M√°s Logros</button>
        </div>

        <!-- Secci√≥n Programa -->
        <div class="program-info">
            <h2 class="program-title pixel-text">üé® PROGRAMA DE DIBUJO ‚Äì 36 TEMAS A PROFUNDIZAR</h2>
            <div class="program-details pixel-text">
                1 clase semanal ‚Äî domingos de 9 a 10 am ‚Äî a domicilio<br>
                Inicio de primera clase : 16 de noviembre<br>
                Artista: Yunchen
            </div>
            
            <div class="topics-container" id="topics-container">
                <!-- Los temas se cargar√°n din√°micamente con JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de Supabase - REEMPLAZA CON TUS PROPIOS DATOS
        const SUPABASE_URL = 'https://tu-proyecto.supabase.co';
        const SUPABASE_ANON_KEY = 'tu-clave-anon-aqui';
        
        // Inicializar Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Contrase√±a de profesor
        const PROFESSOR_PASSWORD = "coche#34";
        
        // Configuraci√≥n por defecto de la aplicaci√≥n
        const defaultConfig = {
            coins: 60,
            avatar: '', // Se cargar√° desde Supabase
            coin: '',   // Se cargar√° desde Supabase
            achievement: '' // Se cargar√° desde Supabase
        };

        // Estado para controlar qu√© logros se muestran
        let logrosVisibles = 4;
        let todosLosLogrosCargados = false;

        // Configuraci√≥n actual de la aplicaci√≥n
        let config = {...defaultConfig};

        // Datos de logros (fechas de cada clase)
        const achievements = [
            { date: "16 Nov" },
            { date: "23 Nov" },
            { date: "30 Nov" },
            { date: "7 Dic" },
            { date: "14 Dic" },
            { date: "21 Dic" },
            { date: "28 Dic" },
            { date: "4 Ene" },
            { date: "11 Ene" },
            { date: "18 Ene" },
            { date: "25 Ene" },
            { date: "1 Feb" },
            { date: "8 Feb" },
            { date: "15 Feb" },
            { date: "22 Feb" },
            { date: "1 Mar" },
            { date: "8 Mar" },
            { date: "15 Mar" },
            { date: "22 Mar" },
            { date: "29 Mar" },
            { date: "5 Abr" },
            { date: "12 Abr" },
            { date: "19 Abr" },
            { date: "26 Abr" },
            { date: "3 May" },
            { date: "10 May" },
            { date: "17 May" },
            { date: "24 May" },
            { date: "31 May" },
            { date: "7 Jun" },
            { date: "14 Jun" },
            { date: "21 Jun" },
            { date: "28 Jun" },
            { date: "5 Jul" },
            { date: "12 Jul" },
            { date: "19 Jul" }
        ];

        // Datos de los temas del programa
        const topics = [
            {
                title: "Exploraci√≥n Creativa y Diagn√≥stico",
                theory: "Qu√© es dibujar; c√≥mo se expresa la creatividad.",
                activity: "Dibuja a tu personaje favorito (Roblox, Banban, TV Mort).",
                coins: "Presentar su dibujo y contar su historia.",
                reward: "Sticker digital animado."
            },
            {
                title: "L√≠neas Verticales y Horizontales",
                theory: "Qu√© son las l√≠neas verticales, horizontales y para qu√© sirven en la composici√≥n",
                activity: "Completar plantilla de l√≠neas con control de pulso.",
                coins: "Completar cada fila sin rendirse.",
                reward: "Marco digital para perfil."
            },
            {
                title: "L√≠neas Diagonales y Curvas",
                theory: "En qu√© ayudan las l√≠neas diagonales, qu√© son las l√≠neas curvas y fluidez",
                activity: "Crear un robot o monstruo solo con curvas + diagonales.",
                coins: "Inventar nombre creativo.",
                reward: "Fondo digital desbloqueable."
            },
            {
                title: "Introducci√≥n al Ashurado",
                theory: "Sombras b√°sicas, trazos suaves, sombreado lineal.",
                activity: "Sombrar un personaje sencillo estilo Roblox.",
                coins: "Terminar 3 niveles de sombra.",
                reward: "Insignia 'Sombra Maestro Nivel 1'."
            },
            {
                title: "Distancias y Proporciones B√°sicas",
                theory: "Qu√© es proporci√≥n, c√≥mo comparar tama√±os",
                activity: "Crear un personaje peque√±o, mediano y grande.",
                coins: "Presentar una comparaci√≥n graciosa.",
                reward: "Carta digital editable."
            },
            {
                title: "Detalle y Enmascarillado",
                theory: "Qu√© es el detalle, qu√© es el enmascarillado (tapar zonas para pintar otras)",
                activity: "Crear mascarilla para personaje (banban, roblox).",
                coins: "Mostrar tres tipos de detalle.",
                reward: "Efecto glitter digital."
            },
            {
                title: "Formas B√°sicas (c√≠rculo, cuadrado, tri√°ngulo)",
                theory: "Todo personaje inicia en formas simples.",
                activity: "Construir 'TV Mort geom√©trico'.",
                coins: "Transformar 2 formas en personajes.",
                reward: "Emoji digital."
            },
            {
                title: "Formas Complejas (cilindro, esfera, cubo)",
                theory: "Volumen b√°sico",
                activity: "Dibujar monstruo en forma de cilindro-cubo-esfera.",
                coins: "Lograr volumen visible.",
                reward: "Sticker 3D."
            },
            {
                title: "Profundidad con Superposici√≥n",
                theory: "Un objeto delante tapa otro.",
                activity: "Dibujo de personaje saltando sobre otro.",
                coins: "Crear escena divertida.",
                reward: "Efecto de sombra digital."
            },
            {
                title: "Proporci√≥n del Cuerpo en Estilo Cartoon",
                theory: "Cabeza grande, cuerpo peque√±o.",
                activity: "Crear avatar estilo cartoon Roblox.",
                coins: "Personalizar 3 accesorios.",
                reward: "Accesorio digital."
            },
            {
                title: "Caras y Emociones",
                theory: "Posici√≥n de ojos, qu√© es la ceja expresiva",
                activity: "Caras feliz, enojado, sorpresa, miedo.",
                coins: "Crear emoci√≥n inventada.",
                reward: "Mini pack de emojis."
            },
            {
                title: "Manos Simplificadas",
                theory: "Manos en forma de mit√≥n.",
                activity: "Personaje saludando.",
                coins: "3 poses diferentes.",
                reward: "Insignia de anatom√≠a."
            },
            {
                title: "Pies y Zapatos Cartoon",
                theory: "Formas simples.",
                activity: "Zapatos roblox o banban.",
                coins: "Dise√±ar zapato raro.",
                reward: "Recompensa sorpresa."
            },
            {
                title: "Volumen con Sombra",
                theory: "Luz y sombra b√°sica.",
                activity: "Sombrear esfera y cubo.",
                coins: "Completar gradientes.",
                reward: "Luz digital animada."
            },
            {
                title: "Perspectiva 1 Punto de Fuga",
                theory: "Qu√© es l√≠nea de horizonte, qu√© es punto de fuga",
                activity: "Camino hacia el horizonte con personaje.",
                coins: "Crear un objeto extra.",
                reward: "Fondo de ciudad desbloqueable."
            },
            {
                title: "Perspectiva 2 Puntos de Fuga",
                theory: "Cubo 2PF",
                activity: "Edificio simple estilo Roblox.",
                coins: "A√±adir letrero creativo.",
                reward: "Edificio digital."
            },
            {
                title: "Perspectiva Curva / Fisheye F√°cil",
                theory: "Curvatura del entorno.",
                activity: "Personaje deformado simp√°tico.",
                coins: "Crear efecto curvo en 2 objetos.",
                reward: "Efecto burbuja."
            },
            {
                title: "Ritmo y Movimiento",
                theory: "L√≠neas de acci√≥n.",
                activity: "Personaje corriendo o saltando.",
                coins: "2 acciones adicionales.",
                reward: "Insignia de movimiento."
            },
            {
                title: "Fondos Simples",
                theory: "C√≥mo dividir cielo, piso, objetos.",
                activity: "Fondo cartoon.",
                coins: "A√±adir detalle secreto.",
                reward: "Fondo digital."
            },
            {
                title: "Fondos Avanzados",
                theory: "Elementos que muestran profundidad.",
                activity: "Fondo tem√°tico (jungla, ciudad, espacio).",
                coins: "Insertar personaje mini.",
                reward: "Fondo premium."
            },
            {
                title: "Color: Psicolog√≠a B√°sica",
                theory: "Colores c√°lidos, fr√≠os, neutros.",
                activity: "Crear paleta del personaje.",
                coins: "2 versiones alternas.",
                reward: "Paleta digital."
            },
            {
                title: "Color Digital (introducci√≥n)",
                theory: "Qu√© es saturaci√≥n y brillo.",
                activity: "Colorear versi√≥n simple.",
                coins: "3 estilos diferentes.",
                reward: "Filtro gr√°fico."
            },
            {
                title: "Texturas",
                theory: "L√≠neas que simulan madera, pelo, metal.",
                activity: "Monstruo con 3 texturas.",
                coins: "Inventar textura nueva.",
                reward: "Textura digital."
            },
            {
                title: "Ropa y Telas",
                theory: "Pliegues b√°sicos.",
                activity: "Outfit Roblox o Banban.",
                coins: "A√±adir detalles.",
                reward: "Accesorio premium."
            },
            {
                title: "C√≥mic: Vi√±etas y Globos",
                theory: "Qu√© es una vi√±eta, globo de di√°logo.",
                activity: "Mini c√≥mic de 3 cuadros.",
                coins: "Twist divertido.",
                reward: "Efecto de sonido digital."
            },
            {
                title: "Luz Avanzada (Reflejos)",
                theory: "C√≥mo rebota la luz.",
                activity: "Objeto brillante.",
                coins: "A√±adir reflejo secundario.",
                reward: "Luz especial."
            },
            {
                title: "Sombras Complejas",
                theory: "Sombra proyectada, sombra propia.",
                activity: "Escena de acci√≥n.",
                coins: "A√±adir 2 sombras m√°s.",
                reward: "Insignia 'Shadow Master'."
            },
            {
                title: "Criaturas Originales",
                theory: "Composici√≥n de partes de animales.",
                activity: "Crear h√≠brido creativo.",
                coins: "Hacer ficha descriptiva.",
                reward: "Carta coleccionable."
            },
            {
                title: "Robots y Mec√°nica",
                theory: "Formas mec√°nicas.",
                activity: "Robot TV Mort estilo 2025.",
                coins: "A√±adir mecanismo secreto.",
                reward: "Recompensa sorpresa."
            },
            {
                title: "Mascotas Fant√°sticas",
                theory: "Simplificaci√≥n anat√≥mica.",
                activity: "Mini mascota original.",
                coins: "Crear 2 variantes.",
                reward: "Mascota digital."
            },
            {
                title: "Ilustraci√≥n Completa",
                theory: "Composici√≥n general.",
                activity: "Ilustraci√≥n a color.",
                coins: "Insertar 3 capas de detalle.",
                reward: "Marco especial."
            },
            {
                title: "Dise√±o de Personaje Original (OC)",
                theory: "Qu√© es un OC.",
                activity: "Dise√±ar personaje √∫nico.",
                coins: "Rellenar ficha completa.",
                reward: "Carta del OC."
            },
            {
                title: "Expresiones Avanzadas",
                theory: "Expresiones combinadas.",
                activity: "6 emociones dif√≠ciles.",
                coins: "Inventar gesto raro.",
                reward: "Pack de emojis raro."
            },
            {
                title: "Estilos Art√≠sticos",
                theory: "Realista, cartoon, chibi, geom√©trico.",
                activity: "Dibujar personaje en 3 estilos.",
                coins: "Explicar cu√°l le gust√≥ m√°s.",
                reward: "Insignia de estilos."
            },
            {
                title: "Preparaci√≥n de Portafolio",
                theory: "C√≥mo elegir mejores obras.",
                activity: "Seleccionar 8 dibujos para su galer√≠a.",
                coins: "Curar su portada.",
                reward: "Fondo premium de expositor."
            },
            {
                title: "Exhibici√≥n Final + Reconocimiento",
                theory: "Qu√© es una exhibici√≥n.",
                activity: "Presentaci√≥n de su galer√≠a final.",
                coins: "Presentar su historia como artista.",
                reward: "Trofeo digital 'Gran Creativo Dibujante'."
            }
        ];

        // Funci√≥n para subir archivo a Supabase Storage
        async function subirArchivo(file, bucket, carpeta, nombreArchivo) {
            try {
                // Verificar que el bucket existe
                const { data: buckets, error: bucketsError } = await supabase.storage.listBuckets();
                if (bucketsError) {
                    console.error('Error listando buckets:', bucketsError);
                    return { error: 'Error conectando con el servidor de almacenamiento' };
                }
                
                const bucketExists = buckets.some(b => b.name === bucket);
                if (!bucketExists) {
                    console.error(`El bucket ${bucket} no existe`);
                    return { error: `El bucket ${bucket} no existe. Crea el bucket en Supabase primero.` };
                }
                
                // Generar un nombre √∫nico para el archivo
                const extension = file.name.split('.').pop();
                const nombreUnico = `${nombreArchivo || Date.now()}.${extension}`;
                const rutaCompleta = `${carpeta}/${nombreUnico}`;
                
                console.log('Subiendo archivo:', rutaCompleta);
                
                const { data, error } = await supabase.storage
                    .from(bucket)
                    .upload(rutaCompleta, file, {
                        cacheControl: '3600',
                        upsert: true
                    });
                
                if (error) {
                    console.error('Error subiendo archivo:', error);
                    
                    // Verificar si es un error de pol√≠ticas
                    if (error.message.includes('policy') || error.message.includes('Policy')) {
                        return { error: 'Error de permisos. Verifica las pol√≠ticas RLS del bucket.' };
                    }
                    
                    return { error: error.message };
                }
                
                // Obtener URL p√∫blica del archivo
                const { data: urlData } = supabase.storage
                    .from(bucket)
                    .getPublicUrl(rutaCompleta);
                
                console.log('Archivo subido. URL:', urlData.publicUrl);
                return { url: urlData.publicUrl };
            } catch (error) {
                console.error('Error en subirArchivo:', error);
                return { error: error.message };
            }
        }

        // Funci√≥n para guardar la configuraci√≥n en localStorage
        function guardarConfiguracion() {
            localStorage.setItem('yunchenAppConfig', JSON.stringify(config));
            console.log('Configuraci√≥n guardada en localStorage:', config);
        }

        // Funci√≥n para cargar la configuraci√≥n desde localStorage
        function cargarConfiguracion() {
            const configGuardada = localStorage.getItem('yunchenAppConfig');
            if (configGuardada) {
                try {
                    const parsedConfig = JSON.parse(configGuardada);
                    config = {...defaultConfig, ...parsedConfig};
                    console.log('Configuraci√≥n cargada desde localStorage:', config);
                } catch (e) {
                    console.error('Error al cargar configuraci√≥n:', e);
                    config = {...defaultConfig};
                }
            } else {
                console.log('No se encontr√≥ configuraci√≥n guardada, usando valores por defecto');
            }
        }

        // Funci√≥n para guardar configuraci√≥n en Supabase
        async function guardarConfiguracionEnSupabase() {
            try {
                const { data, error } = await supabase
                    .from('app_config')
                    .upsert({
                        id: 1,
                        config_data: config,
                        updated_at: new Date()
                    });

                if (error) {
                    console.error('Error guardando en Supabase:', error);
                    return false;
                }
                console.log('Configuraci√≥n guardada en Supabase:', data);
                return true;
            } catch (error) {
                console.error('Error conectando con Supabase:', error);
                return false;
            }
        }

        // Funci√≥n para cargar configuraci√≥n desde Supabase
        async function cargarConfiguracionDesdeSupabase() {
            try {
                const { data, error } = await supabase
                    .from('app_config')
                    .select('config_data')
                    .eq('id', 1)
                    .single();

                if (error) {
                    console.error('Error cargando desde Supabase:', error);
                    return false;
                }

                if (data && data.config_data) {
                    config = {...defaultConfig, ...data.config_data};
                    guardarConfiguracion(); // Guardar en localStorage como respaldo
                    console.log('Configuraci√≥n cargada desde Supabase:', config);
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error conectando con Supabase:', error);
                return false;
            }
        }

        // Funci√≥n para cargar im√°genes iniciales
        async function cargarImagenesIniciales() {
            // Intentar cargar desde Supabase primero
            const cargadoDesdeSupabase = await cargarConfiguracionDesdeSupabase();
            
            // Si no se pudo cargar desde Supabase, cargar desde localStorage
            if (!cargadoDesdeSupabase) {
                cargarConfiguracion();
            }
            
            // Cargar avatar
            const avatarContainer = document.getElementById('avatar-container');
            if (config.avatar) {
                avatarContainer.innerHTML = `<img src="${config.avatar}" alt="Avatar Yunchen" class="avatar-img" id="yunchen-avatar">`;
            } else {
                avatarContainer.innerHTML = `<div style="width:100%;height:100%;background:var(--morado-claro);display:flex;align-items:center;justify-content:center;"><i class="fas fa-user"></i></div>`;
            }
            
            // Cargar coin icon
            const coinIcon = document.getElementById('coin-icon');
            if (config.coin) {
                coinIcon.innerHTML = `<img src="${config.coin}" alt="Coin" class="coin-img" id="coin-image">`;
            } else {
                coinIcon.innerHTML = `<div style="width:100%;height:100%;background:var(--amarillo);border-radius:50%;display:flex;align-items:center;justify-content:center;"><i class="fas fa-coins"></i></div>`;
            }
            
            // Cargar coins count
            document.getElementById('coins-count').textContent = config.coins;
            
            // Cargar logros (solo los primeros 4)
            cargarLogros();
            
            // Cargar temas
            cargarTemas();
        }

        // Funci√≥n para cargar logros (solo los primeros 4 inicialmente)
        function cargarLogros() {
            const container = document.getElementById('achievements-container');
            container.innerHTML = '';
            
            // Mostrar solo los primeros logrosVisibles logros
            const logrosAMostrar = achievements.slice(0, logrosVisibles);
            
            logrosAMostrar.forEach((achievement, index) => {
                const card = document.createElement('div');
                card.className = 'achievement-card pixel-border';
                if (config.achievement) {
                    card.innerHTML = `
                        <div class="achievement-icon">
                            <img src="${config.achievement}" alt="Logro ${index + 1}" class="achievement-img" id="achievement-${index}">
                        </div>
                        <div class="achievement-date pixel-text">${achievement.date}</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="achievement-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="achievement-date pixel-text">${achievement.date}</div>
                    `;
                }
                container.appendChild(card);
            });
            
            // Actualizar el texto del bot√≥n
            const viewMoreBtn = document.getElementById('view-more-btn');
            if (logrosVisibles >= achievements.length) {
                viewMoreBtn.textContent = "Todos los logros cargados";
                viewMoreBtn.disabled = true;
                todosLosLogrosCargados = true;
            } else {
                viewMoreBtn.textContent = "Ver M√°s Logros";
                viewMoreBtn.disabled = false;
                todosLosLogrosCargados = false;
            }
        }

        // Funci√≥n para cargar m√°s logros
        function cargarMasLogros() {
            logrosVisibles += 4;
            if (logrosVisibles > achievements.length) {
                logrosVisibles = achievements.length;
            }
            cargarLogros();
        }

        // Funci√≥n para cargar temas
        function cargarTemas() {
            const container = document.getElementById('topics-container');
            container.innerHTML = '';
            
            topics.forEach((topic, index) => {
                const topicElement = document.createElement('div');
                topicElement.className = 'topic';
                topicElement.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-number">${index + 1}</div>
                        <div class="topic-title pixel-text">${topic.title}</div>
                    </div>
                    <div class="topic-content">
                        <div class="topic-section pixel-text"><strong>Teor√≠a:</strong> ${topic.theory}</div>
                        <div class="topic-section pixel-text"><strong>Actividad:</strong> ${topic.activity}</div>
                        <div class="topic-section coins-info pixel-text"><strong>COINS:</strong> ${topic.coins}</div>
                        <div class="topic-section reward-info pixel-text"><strong>Recompensa:</strong> ${topic.reward}</div>
                    </div>
                `;
                container.appendChild(topicElement);
            });
        }

        // Funciones para el panel de profesor
        function mostrarModalPassword() {
            document.getElementById('password-modal').style.display = 'flex';
            document.getElementById('password-input').focus();
        }

        function cerrarModal() {
            document.getElementById('password-modal').style.display = 'none';
            document.getElementById('password-input').value = '';
        }

        function verificarPassword() {
            const password = document.getElementById('password-input').value;
            if (password === PROFESSOR_PASSWORD) {
                document.getElementById('update-controls').style.display = 'block';
                cerrarModal();
            } else {
                alert('Contrase√±a incorrecta. Intenta nuevamente.');
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            }
        }

        function cerrarPanelProfesor() {
            document.getElementById('update-controls').style.display = 'none';
        }

        // Funciones de actualizaci√≥n de contenido
        async function actualizarCoinsDesdeInput() {
            const nuevoValor = parseInt(document.getElementById('coins-input').value);
            if (!isNaN(nuevoValor) && nuevoValor >= 0) {
                await actualizarCoins(nuevoValor);
                document.getElementById('coins-input').value = '';
                alert('Coins actualizadas correctamente');
            } else {
                alert('Por favor, ingresa un n√∫mero v√°lido para las coins');
            }
        }

        async function actualizarCoins(nuevoValor) {
            config.coins = nuevoValor;
            document.getElementById('coins-count').textContent = nuevoValor;
            
            // Guardar en localStorage
            guardarConfiguracion();
            
            // Intentar guardar en Supabase
            await guardarConfiguracionEnSupabase();
        }

        // Nueva funci√≥n para subir y actualizar avatar
        async function subirYActualizarAvatar() {
            const fileInput = document.getElementById('avatar-file');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Por favor, selecciona un archivo para el avatar');
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validar tama√±o del archivo (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo es demasiado grande. M√°ximo 5MB permitido.');
                return;
            }
            
            const result = await subirArchivo(file, 'yunchen-app', 'avatars', 'avatar');
            
            if (result.url) {
                await actualizarAvatar(result.url);
                fileInput.value = ''; // Limpiar input
                alert('Avatar actualizado correctamente');
            } else {
                alert('Error al subir el avatar: ' + result.error);
            }
        }

        // Nueva funci√≥n para subir y actualizar coin
        async function subirYActualizarCoin() {
            const fileInput = document.getElementById('coin-file');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Por favor, selecciona un archivo para el coin');
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validar tama√±o del archivo (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo es demasiado grande. M√°ximo 5MB permitido.');
                return;
            }
            
            const result = await subirArchivo(file, 'yunchen-app', 'coins', 'coin');
            
            if (result.url) {
                await actualizarCoinIcon(result.url);
                fileInput.value = ''; // Limpiar input
                alert('Coin actualizado correctamente');
            } else {
                alert('Error al subir el coin: ' + result.error);
            }
        }

        // Nueva funci√≥n para subir y actualizar logro espec√≠fico
        async function subirYActualizarLogro() {
            const indice = parseInt(document.getElementById('achievement-index').value);
            const fileInput = document.getElementById('achievement-file');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Por favor, selecciona un archivo para el logro');
                return;
            }
            
            if (isNaN(indice) || indice < 0 || indice >= achievements.length) {
                alert('Por favor, ingresa un √≠ndice v√°lido (0-35)');
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validar tama√±o del archivo (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo es demasiado grande. M√°ximo 5MB permitido.');
                return;
            }
            
            const result = await subirArchivo(file, 'yunchen-app', 'achievements', `achievement-${indice}`);
            
            if (result.url) {
                // Para logros individuales, actualizamos la imagen directamente
                actualizarLogro(indice, result.url);
                fileInput.value = ''; // Limpiar input
                document.getElementById('achievement-index').value = '';
                alert('Logro actualizado correctamente');
            } else {
                alert('Error al subir el logro: ' + result.error);
            }
        }

        // Nueva funci√≥n para subir y actualizar todos los logros
        async function subirYActualizarTodosLogros() {
            const fileInput = document.getElementById('all-achievements-file');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Por favor, selecciona un archivo para todos los logros');
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validar tama√±o del archivo (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('El archivo es demasiado grande. M√°ximo 5MB permitido.');
                return;
            }
            
            const result = await subirArchivo(file, 'yunchen-app', 'achievements', 'achievement-default');
            
            if (result.url) {
                config.achievement = result.url;
                for (let i = 0; i < achievements.length; i++) {
                    actualizarLogro(i, result.url);
                }
                fileInput.value = ''; // Limpiar input
                
                // Guardar cambios
                guardarConfiguracion();
                await guardarConfiguracionEnSupabase();
                cargarLogros(); // Recargar para mostrar los cambios
                alert('Todos los logros actualizados correctamente');
            } else {
                alert('Error al subir la imagen para los logros: ' + result.error);
            }
        }

        async function actualizarAvatar(nuevaUrl) {
            const avatarImg = document.getElementById('yunchen-avatar');
            if (avatarImg) {
                avatarImg.src = nuevaUrl;
            } else {
                document.getElementById('avatar-container').innerHTML = 
                    `<img src="${nuevaUrl}" alt="Avatar Yunchen" class="avatar-img" id="yunchen-avatar">`;
            }
            config.avatar = nuevaUrl;
            
            // Guardar cambios
            guardarConfiguracion();
            await guardarConfiguracionEnSupabase();
        }

        async function actualizarCoinIcon(nuevaUrl) {
            const coinImg = document.getElementById('coin-image');
            if (coinImg) {
                coinImg.src = nuevaUrl;
            } else {
                document.getElementById('coin-icon').innerHTML = 
                    `<img src="${nuevaUrl}" alt="Coin" class="coin-img" id="coin-image">`;
            }
            config.coin = nuevaUrl;
            
            // Guardar cambios
            guardarConfiguracion();
            await guardarConfiguracionEnSupabase();
        }

        function actualizarLogro(indice, nuevaUrl) {
            const achievementImg = document.getElementById(`achievement-${indice}`);
            if (achievementImg) {
                achievementImg.src = nuevaUrl;
            }
        }

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarImagenesIniciales();
            
            // Configurar evento para el bot√≥n de acceso profesor
            document.getElementById('admin-btn').addEventListener('click', mostrarModalPassword);
            
            // Configurar evento para el bot√≥n "Ver m√°s logros"
            document.getElementById('view-more-btn').addEventListener('click', cargarMasLogros);
            
            // Permitir enviar contrase√±a con Enter
            document.getElementById('password-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verificarPassword();
                }
            });
            
            // Hacer funciones globales para facilitar el acceso desde la consola
            window.actualizarCoins = actualizarCoins;
            window.actualizarAvatar = actualizarAvatar;
            window.actualizarCoinIcon = actualizarCoinIcon;
            window.actualizarLogro = actualizarLogro;
            window.subirArchivo = subirArchivo;
        });
    </script>
</body>
</html>
